! R1-2811_sanitized.cfg
! Cisco 2811 – WAN edge / Root CA / IPsec+GRE T1 endpoint
! Homelab config – secrets, keys, and certificate bodies redacted.
!

Building configuration...

Current configuration : 8985 bytes
!
version 15.0
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
!
hostname R1
!
boot-start-marker
boot system flash c2800nm-advipservicesk9-mz.150-1.XA5.bin
boot system flash c2800nm-adventerprisek9_ivs-mz.124-24.T8.bin
boot-end-marker
!
enable secret 5 <REDACTED>
!
aaa new-model
!
aaa authentication login default group radius local
aaa authentication login CONSOLE local
aaa authorization exec default group radius local
!
aaa session-id common
!
clock timezone EST -4
!
dot11 syslog
ip source-route
!
ip cef
ip dhcp excluded-address 192.168.10.1 192.168.10.10
!
ip domain name gootas.org
ip name-server 192.168.10.20
no ipv6 cef
!
multilink bundle-name authenticated
!
voice-card 0
!
crypto pki server CA1
 database archive pem
 issuer-name cn=R1.gootas.org
 grant auto
!
crypto pki trustpoint CA1
 revocation-check crl
 rsakeypair CA_KEYS
!
crypto pki trustpoint 2811
 enrollment url http://192.168.100.1:80
 usage ike
 subject-name cn=R1.gootas.org
 revocation-check none
 rsakeypair 2811-RSA
!
crypto pki certificate chain CA1
 certificate ca 01
 <REDACTED_CERT_BODY_CA1>
        quit
!
crypto pki certificate chain 2811
 certificate 05
 <REDACTED_CERT_BODY_2811>
        quit
 certificate ca 01
 <REDACTED_CERT_BODY_CA1>
        quit
!
license udi pid CISCO2811 sn FTX1106A0ZK
archive
 log config
  hidekeys
username gort secret 5 <REDACTED>
!
redundancy
!
ip ssh version 2
!
class-map match-all ICMP
 match access-group 100
class-map type port-filter match-all BLOCK_PORTS
 match  closed-ports
 match not  port tcp 443
 match not  port udp 1645
 match not  port udp 1646
 match not  port udp 1812
 match not  port udp 1813
class-map type queue-threshold match-all QT_TELNET
 match  protocol telnet
!
policy-map POPO
 class ICMP
    police 8000 conform-action transmit  exceed-action drop
policy-map type queue-threshold POLICE_TELNET
 class QT_TELNET
   queue-limit 2
    log
policy-map type port-filter BAD_PORTS
 class BLOCK_PORTS
   drop
    log
!
crypto isakmp policy 1
 encr aes
 group 14
!
crypto isakmp profile IKE-CERT
 self-identity user-fqdn R1.gootas.org
 ca trust-point 2811
 match identity user-fqdn EDGE.gootas.org
!
crypto ipsec transform-set TS esp-aes 256 esp-sha-hmac
 mode transport
!
crypto ipsec profile GRE-PROFILE-CERT
 set transform-set TS
 set pfs group14
 set isakmp-profile IKE-CERT
!
interface Loopback0
 ip address 192.168.200.200 255.255.255.0
!
interface Tunnel0
 description GRE_TO_EDGE
 ip address 10.255.255.2 255.255.255.252
 ip mtu 1400
 ip nat inside
 ip virtual-reassembly
 ip tcp adjust-mss 1360
 tunnel source FastEthernet0/1
 tunnel destination 172.16.200.2
 tunnel path-mtu-discovery
 tunnel protection ipsec profile GRE-PROFILE-CERT
!
interface FastEthernet0/0
 ip address 10.0.0.50 255.255.255.0
 ip access-group LOCAL_BLOCK in
 ip nat outside
 ip virtual-reassembly
 duplex auto
 speed auto
!
interface FastEthernet0/1
 ip address 192.168.100.1 255.255.255.252
 ip nat inside
 ip virtual-reassembly
 duplex auto
 speed auto
!
ip forward-protocol nd
ip http server
no ip http secure-server
!
ip nat inside source list INBOUND_FILTER interface FastEthernet0/0 overload
ip route 0.0.0.0 0.0.0.0 10.0.0.1
ip route 10.1.1.0 255.255.255.252 Tunnel0
ip route 10.10.10.0 255.255.255.0 Tunnel0
ip route 172.16.50.0 255.255.255.0 Tunnel0
ip route 172.16.100.0 255.255.255.248 Tunnel0
ip route 172.16.200.0 255.255.255.248 192.168.100.2
ip route 192.168.10.0 255.255.255.0 192.168.100.2
ip route 192.168.20.0 255.255.255.0 192.168.100.2
ip route 192.168.99.0 255.255.255.0 192.168.100.2
!
ip access-list extended INBOUND_FILTER
 deny   ip 192.168.0.0 0.0.255.255 10.0.0.0 0.0.0.255
 permit ip 192.168.0.0 0.0.255.255 any
 permit ip 172.16.50.0 0.0.0.255 any
 permit ip 10.1.1.0 0.0.0.3 any
 permit ip 10.10.10.0 0.0.0.255 any
!
ip access-list extended LOCAL_BLOCK
 permit ip host 10.0.0.226 192.168.0.0 0.0.255.255
 deny   ip 10.0.0.0 0.0.0.255 192.168.0.0 0.0.255.255
 permit ip host 10.0.0.226 host 172.16.100.1
 permit tcp host 10.0.0.226 host 10.0.0.50 eq 22
 deny   tcp any host 10.0.0.50 eq 22
 permit ip any host 10.0.0.50
!
ip radius source-interface Loopback0
access-list 1 permit 10.0.0.226
access-list 100 permit icmp any any echo
!
radius-server host 192.168.10.5 auth-port 1812 acct-port 1813 key <REDACTED>
!
control-plane host
 service-policy input POPO
 service-policy type port-filter input BAD_PORTS
 service-policy type queue-threshold input DROP_TELNET
!
control-plane
!
mgcp fax t38 ecm
mgcp behavior g729-variants static-pt
!
line con 0
 login authentication CONSOLE
line aux 0
line vty 0 4
 access-class 1 in
 exec-timeout 0 0
 transport input ssh
line vty 5 15
 access-class 1 in
 exec-timeout 0 0
 transport input ssh
!
scheduler allocate 20000 1000
ntp source FastEthernet0/1
ntp update-calendar
ntp server 192.168.99.100 prefer iburst
end

